---
tags:
  - Spring
---
## Around Advice в Spring AOP

**Around Advice** — это мощный тип аспекта в Spring AOP, который позволяет выполнять действия как до, так и после выполнения целевого метода. Этот совет предоставляет максимальный контроль над поведением метода и может использоваться для изменения параметров, контролирования возвращаемого значения, а также для предотвращения его выполнения.

### Основные характеристики Around Advice

1. **Срабатывание**: Выполняется до и после вызова целевого метода, давая возможность обернуть его поведение.

2. **Управление выполнением метода**: Позволяет вызывать целевой метод или отменять его выполнение.

3. **Изменение аргументов и возвращаемых значений**: Можно изменять как входные параметры, так и возвращаемое значение.

### Синтаксис использования

Для объявления Around Advice используется аннотация `@Around`. В качестве параметра передается `ProceedingJoinPoint`, который позволяет управлять вызовом метода.

#### Пример использования

Вот пример реализации Around Advice для логирования времени выполнения метода.

```java
import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.springframework.stereotype.Component;

@Aspect
@Component
public class PerformanceAspect {

    @Around("execution(* com.example.service.*.*(..))") // Определяем точку среза
    public Object measureExecutionTime(ProceedingJoinPoint joinPoint) throws Throwable {
        long startTime = System.currentTimeMillis(); // Время начала выполнения

        Object result = joinPoint.proceed(); // Вызов целевого метода

        long executionTime = System.currentTimeMillis() - startTime; // Время завершения
        System.out.println("Метод " + joinPoint.getSignature() + " выполнен за " + executionTime + " мс.");

        return result; // Возвращаем результат метода
    }
}
```

### Объяснение кода:

- `@Around`: Указывает, что метод `measureExecutionTime` будет выполнен вокруг целевых методов.
- `pointcut`: Определяет, какие методы будут перехвачены. В данном примере это все методы в пакетах `com.example.service`.
- `ProceedingJoinPoint`: Переменная, которая позволяет продолжить выполнение целевого метода (вызвать его) или отменить вызов.
- `joinPoint.proceed()`: Вызывает целевой метод, и возвращает его результат.

### Применение Around Advice

Around Advice может быть использован в различных сценариях:

1. **Логирование**:
   - Запись времени выполнения методов, их аргументов и возвращаемых значений для мониторинга производительности.

2. **Контроль транзакций**:
   - Начало и завершение транзакций до и после выполнения методов.

3. **Обработка ошибок**:
   - Обработка исключений, выбрасываемых целевыми методами, а также выполнение других действий в случае ошибок.

4. **Изменение аргументов и возвращаемых значений**:
   - Модификация входных данных перед передачей их в метод и обработка результатов, прежде чем вернуть их обратно вызывающему коду.

### Заключение

**Around Advice** является одним из самых мощных инструментов в Spring AOP, позволяя разработчикам внедрять сложные и многоступенчатые логики вокруг целевых методов. Это способствует более четкому разделению бизнес-логики и кросс-функциональных аспектов, что делает код более чистым, управляемым и поддерживаемым.