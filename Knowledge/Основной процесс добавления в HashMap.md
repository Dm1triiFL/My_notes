---
tags:
  - Java
---
Добавление элементов в `HashMap` в Java — это важный процесс, который включает несколько шагов для обеспечения правильного хранения данных внутри коллекции. Давайте подробно рассмотрим, как работает этот процесс.

## Основной процесс добавления в HashMap

### 1. Хеширование ключа

- **Вычисление хеш-кода**: При добавлении новой пары ключ-значение в `HashMap` сначала вызывается метод `hashCode()` для ключа. Это генерирует числовое значение (хеш-код), которое представляет ключ.
  
- **Функция распределения**: Затем этот хеш-код используется для определения «корзины» (bucket), в которую будет помещён элемент. Это достигается с помощью операции `h & (n - 1)`, где `h` — это хеш-код, а `n` — количество корзин, которое всегда является степенью двойки. Это позволяет равномерно распределять элементы по различным корзинам.

### 2. Проверка существования ключа

- **Проверка существующей корзины**: Если корзина уже содержит элементы (это происходит при коллизии), `HashMap` использует метод `equals()` для проверки, существует ли уже элемент с данным ключом.

### 3. Добавление элемента

- **Вставка элемента**: 
  - Если в корзине нет элементов с данным ключом, новая пара ключ-значение будет добавлена.
  - Если ключ уже существует (после проверки `equals()`), значение будет обновлено до нового значения.

### 4. Увеличение размера (при необходимости)

- **Распределение нагрузки**: Если количество элементов в `HashMap` превышает определённый порог (обычно 75% от текущего размера), он увеличивает массив корзин. Это включает следующие шаги:
  - Создание нового массива корзин, вдвое большего, чем текущий.
  - Перемещение всех существующих элементов в новые корзины с использованием новой функции распределения.

## Пример кода

Вот пример, который демонстрирует добавление элементов в `HashMap`:

```java
import java.util.HashMap;

public class HashMapExample {
    public static void main(String[] args) {
        // Создание HashMap
        HashMap<String, Integer> map = new HashMap<>();

        // Добавление элементов
        map.put("Alice", 25);
        map.put("Bob", 30);

        // Обновление значения для существующего ключа
        map.put("Alice", 26);

        // Вывод содержимого HashMap
        System.out.println(map); // {Alice=26, Bob=30}
        
        // Проверка существования ключа
        if (map.containsKey("Alice")) {
            System.out.println("Alice's age: " + map.get("Alice")); // Alice's age: 26
        }
    }
}
```

## Заключение

При добавлении элементов в `HashMap` ключевые моменты включают хеширование ключа, проверку существующих данных, добавление новых пар, а также управление размером массива корзин. Этот эффективный механизм обеспечивает быстрый доступ к значениям и позволяет `HashMap` функционировать как быстрая ассоциативная коллекция.